//焦点图

function myTab(obj){
	var oBox = document.getElementById(obj);
	this.aPicli = oBox.getElementsByTagName("ul")[0].getElementsByTagName("li");
	this.len = this.aPicli.length;
	this.iNow = -1;
	var _this=this;
	var i = 0;
	var timer = null;
	var arr = [];
	for (i=0;i<this.len;i++)
	{
		arr.push("<span>" + "</span>")
	}
	this.oNum = document.createElement("p");
	this.oNum.innerHTML = arr.join("");
	oBox.appendChild(this.oNum);
	this.aBtn = oBox.getElementsByTagName("p")[0].getElementsByTagName("span");
	
	for(i=0;i<this.aBtn.length;i++){
		this.aBtn[i].index = i;
		this.aBtn[i].onclick=function(){
			this.iNow=this.index;
			_this.tab(this.iNow);
		}
	}
	
	_this.autoPlay();
	timer=window.setInterval(function(){
		_this.autoPlay()
	},5000)
	oBox.onmousemove=function(){
		clearInterval(timer)
	}
	oBox.onmouseout=function(){
		timer=setInterval(function(){
			_this.autoPlay()
		},5000)
	}
}

myTab.prototype.autoPlay=function(){
	this.iNow++;
	if(this.iNow>=this.len){
		this.iNow=0
		}
	this.tab(this.iNow);
}


myTab.prototype.tab=function(number){
	for(i=0;i<this.aBtn.length;i++){
		if (i != number) {
			startMove(this.aPicli[i],{opacity:0},function(){
				this.style.display="none";	
			});			
			if (this.aPicli[i].getElementsByTagName('span').length > 0) {
				startMove(this.aPicli[i].getElementsByTagName('span')[0], {opacity:0});
			}
			this.aBtn[i].className="";		
		}	
	}
	this.aBtn[number].className="active";
	this.aPicli[number].style.display="block";
	startMove(this.aPicli[number],{opacity:100});
	if (this.aPicli[number].getElementsByTagName('span').length > 0) {
		startMove(this.aPicli[number].getElementsByTagName('span')[0], {opacity:100});
	}
}


function startMove(obj,json,endFn){
	clearInterval(obj.timer);
	obj.timer = setInterval(function(){
	var bBtn = true;
	for(var attr in json){
		var iCur = 0;
		if(attr == 'opacity'){
			if(Math.round(parseFloat(getStyle(obj,attr))*100)==0){
				iCur = Math.round(parseFloat(getStyle(obj,attr))*100);
			}
			else{
				iCur = Math.round(parseFloat(getStyle(obj,attr))*100) || 100;
			}	
		}
		else{
			iCur = parseInt(getStyle(obj,attr)) || 0;
		}
	
		var iSpeed = (json[attr] - iCur)/8;
		iSpeed = iSpeed >0 ? Math.ceil(iSpeed) : Math.floor(iSpeed);
		if(iCur!=json[attr]){
			bBtn = false;
		}
		//goto
		if(attr == 'opacity'){
			obj.style.filter = 'alpha(opacity=' +(iCur + iSpeed)+ ')';
			obj.style.opacity = (iCur + iSpeed)/100;
		}
		else{
			obj.style[attr] = iCur + iSpeed + 'px';
		}
	}
			
	if(bBtn){
		clearInterval(obj.timer);
		if(endFn){
			endFn.call(obj);
		}
	}
	},30);
	}
//goto
function getStyle(obj,attr){
	if(obj.currentStyle){
		return obj.currentStyle[attr];
	}
	else{
		return getComputedStyle(obj,false)[attr];
	}
}
//结束焦点图
//切换javascript
/*
window.onload=function(){
	new tagTab("tagt1","tagc1","h3","ul");
	new tagTab("tagt2","tagc2","h3","section");
	new tagTab("tagt3","tagc3","h3","section",1);
	new tagTab("tagt4","tagc4","h3","div");
	new myTab("rm_focus");	
	new ad_Img("topad_1");
    new imgTab("hudong");
	new ad_Img("ad_1");
}
*/
function tagTab(objTit,objCnt,objTitName,objCntName,objNum){
	var Tags=document.getElementById(objTit).getElementsByTagName(objTitName);
	var TagsCnt=document.getElementById(objCnt).getElementsByTagName(objCntName);
	var len=Tags.length;
	if (objNum==null || objNum==""){ var flag=0; }
	else {	var flag=objNum; }
	for(i=0;i<len;i++){
		Tags[i].value = i;
		Tags[i].onmouseover=function(){changeNav(this.value)};
		TagsCnt[i].className='undis';
	}
	Tags[flag].className='';
	TagsCnt[flag].className='dis';
	function changeNav(v){
		Tags[flag].className='unfocus';
		TagsCnt[flag].className='undis';
		flag=v;
		Tags[v].className='';
		TagsCnt[v].className='dis';
	}
}
//下拉菜单
var timeout         = 100;
var timeout_h         = 200;
var closetimer	    = 0;
var ddmenuitem  = 0;
function mopen(id)
{	
	mcancelclosetime();
	if(ddmenuitem) ddmenuitem.style.visibility = 'hidden';
	ddmenuitem = document.getElementById(id);
	ddmenuitem.style.visibility = 'visible';

}
function mclose()
{
	if(ddmenuitem) ddmenuitem.style.visibility = 'hidden';
}
function mclosetime()
{
	closetimer = window.setTimeout(mclose, timeout);
}
function closetime()
{
	closetimer = window.setTimeout(mclose, timeout_h);
}
function mcancelclosetime()
{
	if(closetimer)
	{
		window.clearTimeout(closetimer);
		closetimer = null;
	}
}
 
//设为首页
    function SetHome(url){
        if (document.all) {
            document.body.style.behavior='url(#default#homepage)';
               document.body.setHomePage(url);
        }else{
            alert("抱歉,您的浏览器不支持自动设置首页,请使用浏览器菜单手动设置!");
        }
    }
//加入收藏
        function AddFavorite(sURL, sTitle) {
            sURL = encodeURI(sURL); 
        try{   
            window.external.addFavorite(sURL, sTitle);   
        }catch(e) {   
            try{   
                window.sidebar.addPanel(sTitle, sURL, "");   
            }catch (e) {   
                alert("抱歉,您的浏览器不支持自动加入收藏，请使用Ctrl+D进行添加,或使用浏览器菜单手动设置!");
            }   
        }
    }
//推广图片切换
function ad_Img(obj){
	var oBox = document.getElementById(obj);
	this.aPicli = oBox.getElementsByTagName("ul")[0].getElementsByTagName("li");
	this.len = this.aPicli.length;
	this.iNow = 0;
	var _this=this;
	var i = 0;
	var timer = null;
	var arr = [];
		
	_this.autoPlay();
	timer=window.setInterval(function(){
		_this.autoPlay()
	},5000)
}

ad_Img.prototype.autoPlay=function(){
	this.iNow++;
	if(this.iNow>=this.len){
		this.iNow=0
		}
	this.tab(this.iNow);
}

ad_Img.prototype.tab=function(number){
for(i=0;i<this.aPicli.length;i++){
		startMove(this.aPicli[i],{opacity:0},function(){
			this.style.display="none";
		});						
	}
	this.aPicli[number].style.display="block";
	startMove(this.aPicli[number],{opacity:100});
}
/*图片切换列表*/
function imgTab(){
	var Tags=document.getElementById("hudong").getElementsByTagName("dl");
	var len=Tags.length;
	var flag=0;
	for(i=0;i<len;i++){
		Tags[i].value = i;
		Tags[i].onmouseover=function(){changeNav(this.value)};
	}
	function changeNav(v){
		Tags[flag].className='inter_unfocus';
		flag=v;
		Tags[v].className='inter_focus';
	}
	changeNav(0);
}
var float_nav = $(".top_nav");
var oList = $(".drop_down");
var oLogin = $(".p_login");
var oSearch = $(".p_search");
var oTbbs = $(".t_bbs_pop");
var oTpeople = $(".t_people_pop");
var oStyle_xy = $(".main_h").offset();
function close_t(){
  oTbbs.addClass("close_tip");
  oTpeople.addClass("close_tip");
}
function open_t(){
   if(oTbbs.find("p").html() == ""){
		oTbbs.addClass("close_tip");
		}else{
		oTbbs.removeClass("close_tip");    
	}
	if(oTpeople.find("p").html() == ""){
		oTpeople.addClass("close_tip");
		}
	else{
		oTpeople.removeClass("close_tip");    
	}
}
   $(window).scroll(function (e) {
        var top_a=$(document).scrollTop();
		if(top_a>oStyle_xy.top){
		   close_t();
		}
		if(top_a>oStyle_xy.top+350){
			open_t();
		}else if(top_a<oStyle_xy.top){
		    open_t();
		}
        if (top_a >= 38) {
		  float_nav.css({position:"fixed",top:"0px",zIndex:"20"});
		  oTbbs.css({zIndex:"45"});
		  oTpeople.css({zIndex:"45"});
		  if(typeof document.body.style.maxHeight === "undefined") {
	              oList.css({position:"absolute"});
				  oLogin.css({position:"absolute"});
				  oSearch.css({position:"absolute"});
				  oTbbs.css({position:"absolute"});
				  oTpeople.css({position:"absolute"});
           }else if(navigator.appName == "Microsoft Internet Explorer" && navigator.appVersion .split(";")[1].replace(/[ ]/g,"")=="MSIE7.0") 
{ 
         oList.css({position:"absolute"});
				  oLogin.css({position:"absolute"});
				  oSearch.css({position:"absolute"});
				  oTbbs.css({position:"absolute"});
				  oTpeople.css({position:"absolute"});
} else{
				  oList.css({position:"fixed"});
				  oLogin.css({position:"fixed"});
				  oSearch.css({position:"fixed"});   
				  oTbbs.css({position:"fixed"});
				  oTpeople.css({position:"fixed"});
			}
        } else if (top_a < 38) {
		  float_nav.css({position:"static",top:"0px",zIndex:"20"});
        }
})
//微博与社区提示
open_t();
$(".close_t_people").click(function(){
	oTpeople.hide();
	$("#t_people_tip").hide();
	});
$(".close_t_bbs").click(function(){
	oTbbs.hide();
	$("#t_bbs_tip").hide();
});


//返回顶部
$(document).ready(function() {
    var $backToTopTxt = "", $backToTopEle = $('<div class="backToTop"></div>').appendTo($("body"))
        .text($backToTopTxt).attr("title", $backToTopTxt).click(function() {
            $("html, body").animate({ scrollTop: 0 }, 120);
    }), $backToTopFun = function() {
        var st = $(document).scrollTop(), winh = $(window).height();
        (st > 0)? $backToTopEle.show(): $backToTopEle.hide();    
        //IE6下的定位
        if (!window.XMLHttpRequest) {
            $backToTopEle.css("top", st + winh - 166);    
        }
    };
    $(window).bind("scroll", $backToTopFun);
    $(function() { $backToTopFun(); });
});
